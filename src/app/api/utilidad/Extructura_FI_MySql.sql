drop  TABLE fi.tipo_cuentas;

CREATE TABLE fi.tipo_cuentas (
  ticu_id int NOT NULL AUTO_INCREMENT,
  ticu_nombre varchar(100) NOT NULL,
  PRIMARY KEY (ticu_id)
);


INSERT INTO fi.tipo_cuentas (ticu_id,ticu_nombre)
VALUES
(1,'ACTIVO'),
(2,'PASIVO'),
(3,'PATRIMONIO'),
(4,'INGRESO'),
(5,'EGRESO'),
(6,'GASTO'),
(7,'COSTO'),
(8,'GANANCIA'),
(9,'PERDIDA');


SELECT * FROM fi.tipo_cuentas;

drop TABLE bd_fi.maestro_cuentas;
CREATE TABLE bd_fi.maestro_cuentas (
  macu_codigo int NOT NULL,
  macu_nombre varchar(250) NOT NULL,
  macu_informe  varchar(100)  NULL,
  macu_grupo varchar(100)  NULL,
  macu_nivel int DEFAULT NULL,
  macu_codigo_padre int DEFAULT NULL,
  ticu_id int DEFAULT NULL,
  PRIMARY KEY (macu_codigo)
) ;

INSERT INTO fi.maestro_cuentas (
macu_codigo,	macu_informe,	 ticu_id,	macu_grupo,	 macu_nombre,	 macu_nivel,	 macu_codigo_padre)
values
(100000,'BALANCE',1, null ,'ACTIVOS',0,null),
(100001,'BALANCE',1,'CORRIENTES','EFECTIVO Y EQUIVALENTE AL EFECTIVO',1,100000),
(100003,'BALANCE',1,'CORRIENTES','DEUDORES COMERCIALES Y OTRAS CUENTAS POR COBRAR',1,100000),
(100005,'BALANCE',1,'CORRIENTES','CUENTAS POR COBRAR A ENTIDADES RELACIONADAS',1,100000),
(100007,'BALANCE',1,'CORRIENTES','OTROS EQUIVALENTES A EXISTENCIA',1,100000),
(100009,'BALANCE',1,'CORRIENTES','OTROS ACTIVOS CORRIENTES',1,100000),
(100011,'BALANCE',1,'CORRIENTES','INVENTARIOS CORRIENTES',1,100000),
(100012,'BALANCE',1,'CORRIENTES','ACTIVOS POR IMPUESTOS CORRIENTES',1,100000),
(100013,'BALANCE',1,'NO CORRIENTES','OTROS ACTIVOS FINANCIEROS NO CORRIENTES',1,100000),
(100014,'BALANCE',1,'NO CORRIENTES','CUENTAS POR COBRAR A ENTIDADES RELACIONADAS',1,100000),
(100015,'BALANCE',1,'NO CORRIENTES','PROPIEDADES , PLANTAS Y EQUIPOS',1,100000),
(100016,'BALANCE',1,'NO CORRIENTES','PROPIEDADES DE INVERSIÓN',1,100000),
(100017,'BALANCE',1,'NO CORRIENTES','INTANGIBLES',1,100000),
(100018,'BALANCE',1,'NO CORRIENTES','ACTIVO INTANGIBLE DISTINTO A LA PLUSVALIA',1,100000),
(100019,'BALANCE',1,'NO CORRIENTES','OTROS ACTIVOS NO FINANCIEROS NO CORRIENTES',1,100000),
(200000,'BALANCE',2, null ,'PASIVOS',0,null),
(200001,'BALANCE',2,'CORRIENTES','OTROS PASIVOS FINANCIEROS CORRIENTES',1,200000),
(200002,'BALANCE',2,'CORRIENTES','CUENTAS POR PAGAR COMERCIALES Y OTRAS CUENTAS ',1,200000),
(200003,'BALANCE',2,'CORRIENTES','CUENTAS POR PAGAR A ENTIDADES RELACIONADAS',1,200000),
(200004,'BALANCE',2,'CORRIENTES','PASIVOS POR IMPUESTOS CORRIENTES',1,200000),
(200005,'BALANCE',2,'CORRIENTES','PROVISIONES CORRIENTES POR BENEFICIO A LOS EMPLEADOS',1,200000),
(200006,'BALANCE',2,'CORRIENTES','PROVISIÓN FACTURAS POR RECIBIR',1,200000),
(200007,'BALANCE',2,'NO CORRIENTES','OTROS PASIVOS FINANCIEROS NO CORRIENTES',1,200000),
(200008,'BALANCE',2,'NO CORRIENTES','CUENTAS POR PAGAR A ENTIDADES RELACIONADAS',1,200000),
(200009,'BALANCE',2,'NO CORRIENTES','PASIVOS POR IMPUESTOS DIFERIDOS',1,200000),
(300000,'BALANCE',3, null ,'PATRIMONIO',0,null),
(300001,'BALANCE',3,'PATRIMONIO NETO','CAPITAL PAGADO',1,300000),
(300002,'BALANCE',3,'PATRIMONIO NETO','OTRAS RESERVAS',1,300000),
(300003,'BALANCE',3,'PATRIMONIO NETO','GANANCIAS ACUMULADAS',1,300000),
(300004,'BALANCE',3,'PATRIMONIO NETO','CUENTAS PARTICULARES',1,300000),
(300005,'BALANCE',3, null ,'PARTICIPACIONES NO CONTROLADORAS',1,300000),
(800000,'ESTADO DE RESULTADO',8, null ,'GANANCIA',0,null),
(800001,'ESTADO DE RESULTADO',8, null ,'INGRESO DE ACTIVIDADES ORDINARIAS',1,800000),
(800002,'ESTADO DE RESULTADO',8, null ,'COSTOS DE VENTAS (INC. DEP.)',1,800000),
(600000, 'ESTADO DE RESULTADO' ,6, null ,'GASTOS',0,null),
(600001,'ESTADO DE RESULTADO',6, null ,'GASTOS DE DISTRIBUCIÓN',1,600000),
(600002,'ESTADO DE RESULTADO',6, null ,'GASTOS DE ADMINISTRACIÓN Y VENTAS (INC. DEP.)',1,600000),
(400000, 'ESTADO DE RESULTADO' ,4, null ,'INGRESO',0,null),
(400001,'ESTADO DE RESULTADO',4, null ,'OTROS INGRESOS POR FUNCIÓN',1,400000),
(500000, 'ESTADO DE RESULTADO' ,5, null ,'EGRESO',0,null),
(500001,'ESTADO DE RESULTADO',5, null ,'OTROS GASTOS',1,500000),
(400002,'ESTADO DE RESULTADO',4, null ,'INGRESOS FINANCIEROS',1,400000),
(500002,'ESTADO DE RESULTADO',5, null ,'COSTOS FINANCIEROS',1,500000),
(500003,'ESTADO DE RESULTADO',5, null ,'CONTRIBUCIONES',1,500000),
(500004,'ESTADO DE RESULTADO',5, null ,'GASTOS GENERALES',1,500000),
(400003,'ESTADO DE RESULTADO',4, null ,'RESULTADO POR UNIDAD DE REAJUSTE',1,400000),
(500005,'ESTADO DE RESULTADO',5, null ,'IMPUESTO A LA RENTA',1,500000),
(700000,'ESTADO DE RESULTADO',7, null ,'COSTO',0,null),
(700001,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','DEPRECIACION',1,700000),
(700002,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','REMUNERACIONES ',1,700000),
(700003,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','COSTOS  VEHICULOS Y ARRIENDO MAQUINARIA',1,700000),
(700004,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','PASAJES, PEAJES Y OTROS',1,700000),
(700005,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','SUBCONTRATOS',1,700000),
(700006,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','ALOJAMIENTO Y HOSPEDEJE',1,700000),
(700007,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','MATERIALES',1,700000),
(700008,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','SERVICIOS Y MAESTRANZA',1,700000),
(700009,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','EPP',1,700000),
(700010,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','HERRAMIENTAS MENORES',1,700000),
(700011,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','EXÁMENES PERSONAL',1,700000),
(700012,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','HONORARIOS TÉCNICOS',1,700000),
(700013,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','SEGUROS',1,700000),
(700014,'ESTADO DE RESULTADO',7,'COSTOS DE VENTA','OTROS',1,700000),
(600003,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','DEPRECIACIÓN',1,600000),
(600004,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','REMUNERACIONES',1,600000),
(600005,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','GASTOS GENERALES',1,600000),
(600006,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','MANTENCIÓN, COMUNICACIONES',1,600000),
(600007,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','HONORARIOS',1,600000),
(600008,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','GASTOS DE VEHÍCULOS',1,600000),
(600009,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','DETERIORO',1,600000),
(600010,'ESTADO DE RESULTADO',6,'GASTOS DE ADMINISTRACIÓN Y VENTAS','OTROS GASTOS',1,600000);




CREATE TABLE fi.balances (
  blnc_id int NOT NULL AUTO_INCREMENT,
  macu_codigo int NOT NULL,
  blnc_monto decimal(18,2) NOT NULL DEFAULT '0.00',
  blnc_ano int NOT NULL,
  PRIMARY KEY (`blnc_id`)
);


insert into  fi.balances ( macu_codigo,blnc_monto,blnc_ano)
values
(100001,2200006,2023),
(100001,2210579,2021),
(100001,2520751,2022),
(100001,2720365,2024),
(100003,14431880,2021),
(100003,24060314,2023),
(100003,37776758,2024),
(100003,9979946,2022),
(100005,0,2021),
(100005,0,2022),
(100005,0,2023),
(100005,26590,2024),
(100007,0,2021),
(100007,0,2022),
(100007,0,2023),
(100007,0,2024),
(100009,0,2022),
(100009,0,2023),
(100009,600112,2024),
(100009,815866,2021),
(100011,0,2021),
(100011,0,2022),
(100011,0,2023),
(100011,0,2024),
(100012,0,2023),
(100012,366079,2024),
(100012,402142,2021),
(100012,75018,2022),
(100013,17710,2023),
(100013,18426,2024),
(100013,8000,2021),
(100013,8000,2022),
(100014,60136,2021),
(100014,60136,2022),
(100014,60136,2023),
(100014,60136,2024),
(100015,13338811,2024),
(100015,6323205,2021),
(100015,7838603,2022),
(100015,8157909,2023),
(100016,1332681,2024),
(100016,513356,2023),
(100016,531517,2022),
(100016,549682,2021),
(100017,0,2021),
(100017,0,2022),
(100017,0,2023),
(100017,0,2024),
(100018,0,2021),
(100018,0,2022),
(100018,0,2023),
(100018,0,2024),
(100019,0,2021),
(100019,0,2022),
(100019,0,2023),
(100019,0,2024),
(200001,1198077,2022),
(200001,1414371,2023),
(200001,1921358,2021),
(200001,6086700,2024),
(200002,11916411,2024),
(200002,2512428,2022),
(200002,5489920,2021),
(200002,8590809,2023),
(200003,0,2022),
(200003,0,2023),
(200003,0,2024),
(200003,138962,2021),
(200004,0,2021),
(200004,0,2022),
(200004,0,2024),
(200004,753011,2023),
(200005,165794,2022),
(200005,295210,2021),
(200005,386309,2023),
(200005,734459,2024),
(200006,0,2022),
(200006,0,2023),
(200006,0,2024),
(200006,296490,2021),
(200007,1253989,2022),
(200007,2593843,2024),
(200007,675960,2021),
(200007,954409,2023),
(200008,0,2021),
(200008,138962,2022),
(200008,138962,2023),
(200008,138962,2024),
(200009,1300480,2023),
(200009,1300480,2024),
(200009,665935,2021),
(200009,890490,2022),
(300001,20000,2021),
(300001,20000,2022),
(300001,20000,2023),
(300001,20000,2024),
(300002,0,2021),
(300002,0,2022),
(300002,0,2023),
(300002,0,2024),
(300003,14396744,2022),
(300003,14846988,2021),
(300003,20814868,2023),
(300003,32481125,2024),
(300004,437487,2022),
(300004,450667,2021),
(300004,636212,2023),
(300004,967978,2024),
(300005,0,2021),
(300005,0,2022),
(300005,0,2023),
(300005,0,2024),
(400001,-112000,2021),
(400001,153009,2024),
(400001,311014,2023),
(400001,478646,2022),
(400002,125136,2023),
(400002,3660,2021),
(400002,42600,2022),
(400002,7,2024),
(400003,2993,2023),
(400003,35566,2024),
(400003,38497,2022),
(400003,77858,2021),
(500001,-12053,2024),
(500001,0,2021),
(500001,0,2022),
(500001,0,2023),
(500002,-275904,2021),
(500002,-341073,2022),
(500002,-371152,2023),
(500002,-826804,2024),
(500003,0,2021),
(500003,0,2022),
(500003,0,2023),
(500003,0,2024),
(500004,0,2021),
(500004,0,2022),
(500004,0,2023),
(500004,0,2024),
(500005,-1021394,2022),
(500005,-3353007,2023),
(500005,-5173179,2024),
(500005,-631937,2021),
(600001,172751,2023),
(600001,177871,2022),
(600001,179619,2024),
(600001,258217,2021),
(600002,-2192787,2022),
(600002,-2308711,2021),
(600002,-2851614,2024),
(600002,-3023023,2023),
(600002,1387704,2021),
(600002,1525275,2022),
(600002,1527434,2024),
(600002,1610856,2023),
(600003,236922,2022),
(600003,243728,2021),
(600003,559299,2023),
(600003,684306,2024),
(600004,136771,2022),
(600004,172743,2021),
(600004,303928,2024),
(600004,305847,2023),
(600005,101034,2021),
(600005,108882,2023),
(600005,111089,2024),
(600005,77904,2022),
(600006,17274,2021),
(600006,255976,2023),
(600006,29563,2024),
(600006,9474,2022),
(600007,0,2024),
(600007,128011,2021),
(600007,9290,2023),
(600007,9625,2022),
(600008,0,2021),
(600008,122,2023),
(600008,15675,2024),
(600008,18945,2022),
(700001,1201832,2024),
(700001,698705,2022),
(700001,747328,2021),
(700001,866899,2023),
(700002,20703062,2021),
(700002,23409204,2022),
(700002,29652332,2023),
(700002,54508337,2024),
(700003,10649865,2024),
(700003,5362560,2021),
(700003,6068185,2022),
(700003,6378848,2023),
(700004,10136738,2024),
(700004,4500330,2021),
(700004,5000421,2023),
(700004,5558930,2022),
(700005,10006818,2023),
(700005,5876922,2021),
(700005,6135358,2022),
(700005,9485709,2024),
(700006,1085078,2023),
(700006,1219131,2022),
(700006,2418778,2024),
(700006,3249088,2021),
(700007,10151586,2022),
(700007,16286925,2024),
(700007,5694859,2021),
(700007,6703385,2023),
(700008,355770,2024),
(700008,464322,2023),
(700008,638314,2022),
(700008,777169,2021),
(700009,1041767,2022),
(700009,1488639,2023),
(700009,2086945,2024),
(700009,870593,2021),
(700010,195665,2021),
(700010,334252,2022),
(700010,934165,2023),
(700010,942873,2024),
(700011,664637,2022),
(700011,747584,2023),
(700011,877877,2024),
(700011,880957,2021),
(700012,101429,2022),
(700012,135901,2023),
(700012,353958,2024),
(700012,69546,2021),
(700013,153272,2022),
(700013,212765,2023),
(700013,420427,2024),
(700013,91049,2021),
(700014,1030559,2022),
(700014,722513,2024),
(700014,793786,2023),
(700014,975242,2021),
(800001,134499901,2024),
(800001,54960291,2021),
(800001,63163180,2022),
(800001,80534825,2023),
(800002,-110448547,2024),
(800002,-49994370,2021),
(800002,-57205329,2022),
(800002,-64470943,2023);




create table formulas(
	fmls_codigo  int NOT NULL,
	fmls_desc  TEXT NOT NULL,
    fmls_body  TEXT NOT NULL,
	PRIMARY KEY (fmls_codigo)
);

INSERT INTO formulas (fmls_codigo, fmls_desc, fmls_body) VALUES
    (10001, 'utilidad_basica',      "(
  ('800001' + '800002' + '700001' + '600001' + '600002' + '600003' - '700001' - '600003' + 
   '400001' + '500001' + '400002' + '500003' + '500004' + '400003')
  / 'p_UNID_MED"
) - ('500005' / 'p_UNID_MED')'),
    (10002, 'ventas', "'800001'/ p_UNID_MED"),
    (10003, 'INTERESES A OPERACIONAL',"'500002' / p_UNID_MED" ),
    (10004, 'CREACION VALOR', ""),
    (10005, 'EBITDA', "(('800001' + '800002' + '700001' + '600001' + '600002' + '600003' - '700001' - '600003') / p_UNID_MED) -(- '700001' / p_UNID_MED - '600003' / p_UNID_MED)"),
    (10006, 'VALOR DEUDA', "('200001' + '200007') / p_UNID_MED)"),
    (10007, 'VALOR PATRIMONIO', "('300001' + '300002' + '300003' + '300004') / p_UNID_MED"),
    (10008, 'CRECIMIENTO PATRIMONIO', "(('300001' + '300002' + '300003' + '300004') - ('300001_ant' + '300002_ant' + '300003_ant' + '300004_ant')) / ('300001_ant + '300002_ant' + '300003_ant' + '300004_ant')"),
    (10009, 'RENTABILIDAD DEL CAPITAL', "(
 (
  '800001'
  + ('800002' + '700001')
  + '600001'
  + ('600002' + '600003')
  + (-'700001' - '600003')
 )
)
/
(
 (
  '100001'
  + ('100003' + '100007' + '100005')
  + '100011'
  + '100009'
  + '100012'
  + '100013'
  + ('100016' + '100017' + '100018' + '100019' + '100014')
  + [ '100015'
      - (
          (
           (-'700001_ant' - '600003_ant')
           + (-'700001_ant' - '600003_ant')
           + (-'700001' - '600003')
          )
          + 
          ( 
            (-'700001' - '600003')
            - 
            (-'700001' - '600003')_ant
          )
        )
    ]
  + [ 
      (
       (-'700001_ant' - '600003_ant')
       + (-'700001_ant' - '600003_ant')
       + (-'700001' - '600003')
      )
      + 
      ( 
        (-'700001' - '600003')
        - 
        (-'700001' - '600003_ant')
      )
    ]
 )
)
/
p_UNID_MED
)"),
(10009,'ROTACIÓN DE ACTIVOS' , "(
 '800001'
)
/
(
 '100001'
 + ('100003' + '100007' + '100005')
 + '100011'
 + '100009'
 + '100012'
 + '100013'
 + ('100016' + '100017' + '100018' + '100019' + '100014')
 + [ '100015'
     - (
         ((-'700001_ant' - '600003_ant')
         + (-'700001_ant' - '600003_ant')
         + (-'700001' - '600003'))
         + 
         ( (-'700001' - '600003') - (-'700001' - '600003')_ant )
       )
   ]
 + [ 
      ((-'700001_ant' - '600003_ant')
      + (-'700001_ant' - '600003_ant')
      + (-'700001' - '600003'))
      + 
      ( (-'700001' - '600003') - (-'700001' - '600003')_ant )
   ]
)
/
p_UNID_MED"),




INSERT INTO formulas (fmls_codigo, fmls_desc, fmls_body) VALUES
    (90001, 'utilidad_basica_proyeccion', 'base * (param / 100) + 250000'),
    (90002, 'ventas_proyeccion',"(base * PROY_VENTAS) + base" );




create table parametros(
  prmt_id int NOT NULL AUTO_INCREMENT,
  prmt_codigo VARCHAR(255) NOT NULL,
  prmt_desc TEXT NOT NULL,
  prmt_valor decimal(18,2) NOT NULL,
  prmt_ano int,
  PRIMARY KEY (prmt_id)
);

insert into parametros (prmt_id,prmt_codigo, prmt_desc, prmt_valor ,prmt_ano) values 
(10001,'EV_ABR', 'estacionalidad ventas', 0.1,null),
(10002,'UNID_MED', 'unidad medida', 1000,null),
(10003,'PROY_UTIL', 'proyeccion utilidad', 0.8,2025),
(10004,'PROY_UTIL', 'proyeccion utilidad', 0.85,2026),
(10005,'PROY_UTIL', 'proyeccion utilidad', 0.9,2027),
(10006,'PROY_UTIL', 'proyeccion utilidad', 0.95,2029);